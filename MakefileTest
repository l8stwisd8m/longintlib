# compiler options
CC = gcc
CFLAGS = -Wall
LDFLAGS = -Llib -llongint
RPATH = -Wl,-rpath=./lib

# directories
BIN_DIR = bin
TEST_DIR = test
UTILS_DIR = utils

# source files
SRC_FILES = $(wildcard $(TEST_DIR)/*.c)
UTILS_SRC = $(TEST_DIR)/$(UTILS_DIR)/test_utils.c

# object files
OBJ_FILES = $(SRC_FILES:.c=.o)
UTILS_OBJ = $(UTILS_SRC:.c=.o)

# targets
TARGETS = $(patsubst $(TEST_DIR)/%.c, $(BIN_DIR)/%, $(SRC_FILES))

.PHONY: all clean

all: $(BIN_DIR) $(TARGETS)

$(BIN_DIR):
	mkdir -p $(BIN_DIR)

$(BIN_DIR)/%: $(TEST_DIR)/%.c $(UTILS_OBJ)
	$(CC) $(CFLAGS) -o $@ $^ $(LDFLAGS) $(RPATH)

$(UTILS_OBJ): $(UTILS_SRC)
	$(CC) $(CFLAGS) -c $< -o $@

clean:
	rm -rf $(TARGETS) $(UTILS_OBJ)
